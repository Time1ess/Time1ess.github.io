<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Python正则表达式中的反斜线 · David's Blog</title><meta name="description" content="Python正则表达式中的反斜线 - David"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/imgs/favicon.ico"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/bootstrap-theme.css"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/david.css"><link rel="search" type="application/opensearchdescription+xml" href="http://youchen.me/atom.xml" title="David's Blog"><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><script async type="text/javascript" src="//cdnjs.cloudflare.com/ajax//libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/typeahead.js"></script><script src="/js/search.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-89945048-1",'auto');ga('send','pageview');</script><script>(function(){var bp = document.createElement('script');var curProtocol = window.location.protocol.split(':')[0];if (curProtocol === 'https') {bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';}else {bp.src = 'http://push.zhanzhang.baidu.com/push.js';}var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp, s);})();</script></head><body><div id="search"><div id="search-panel" class="search-panel"><div class="search-input"><input id="search-keywords" type="text" placeholder="搜索范围: 文章标题 日期 标签" class="form-control"><ul role="list" class="typeahead dropdown-menu"></ul></div><div class="search-close"><a id="search-close" href="#"><img src="/imgs/close-white.png"></a></div></div><div class="search-button"><a id="search-open" title="双击Ctrl快速打开搜索框"><img src="/imgs/search-black.png"></a></div></div><div class="apollo-wrap"><header class="apollo"><a href="/" class="logo-link"><img src="/imgs/favicon.png" alt="logo"></a><ul class="apollo-nav apollo-nav-list"><li class="apollo-nav-list-item"><a href="/" target="_self" class="apollo-nav-list-link">博客</a></li><li class="apollo-nav-list-item"><a href="/archives" target="_self" class="apollo-nav-list-link">归档</a></li><li class="apollo-nav-list-item"><a href="/categories" target="_self" class="apollo-nav-list-link">分类</a></li><li class="apollo-nav-list-item"><a href="https://github.com/Time1ess" target="_blank" class="apollo-nav-list-link">GITHUB</a></li><li class="apollo-nav-list-item"><a href="/atom.xml" target="_self" class="apollo-nav-list-link">RSS</a></li><li class="apollo-nav-list-item"><a href="/about" target="_self" class="apollo-nav-list-link">关于</a></li></ul></header><main class="apollo-container"><div class="post"><article class="post-block"><h1 class="post-title">Python正则表达式中的反斜线</h1><div class="post-info">时间: 2017年4月24日 10:13 标签: <a class="tags" href="/tags/Python/">#Python</a>,<a class="tags" href="/tags/正则/">#正则</a>,<a class="tags" href="/tags/re模块/">#re模块</a></div><div class="post-content"><p>正则表达式是一个十分强大的工具，可以完成对字符串的模式匹配以及提取工作，在很多工程中都被广泛使用，但是我之前对于Python正则表达式模块<code>re</code>的使用都没有进行一些深入学习，对<strong>原始字符串</strong>之类的了解也比较浅显，之前有个同学问到我关于反斜线<code>\</code>在正则中的一些表现的时候我也迷惑了，跟周围人讨论后上<a href="http://stackoverflow.com" target="_blank" rel="noopener">StackOverflow</a>问了一番，对这方面又多了一些了解，今天跟大家分享。</p>
<a id="more"></a>
<h1 id="字符串中的反斜线"><a href="#字符串中的反斜线" class="headerlink" title="字符串中的反斜线\"></a>字符串中的反斜线<code>\</code></h1><p>我们知道，反斜线<code>\</code>在字符串以及正则表达式中都是完成转义的工作，比如我有一个字符串s1:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = <span class="string">'123'</span></span><br></pre></td></tr></table></figure>
<p>现在这个字符串s1内容为<code>123</code>，如果我想在字符串中保留一个单引号<code>&#39;</code>，那么我可能的一种做法是使用双引号来包含内容，字符串s2:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">"12'3"</span></span><br></pre></td></tr></table></figure>
<p>Python中的单引号<code>&#39;</code>和双引号<code>&#39;</code>其实都可以用来指示字符串，我们在此处使用双引号而不是单引号，原因是因为如果使用单引号Python解释器将会无法对这条语句进行正常解释，因为紧跟2之后的<code>&#39;</code>被用来指示字符串结束，然而后面还剩下<code>3</code>这个字符，所以会引发<code>Syntax Error</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'12'</span><span class="number">3</span><span class="string">'</span></span><br><span class="line"><span class="string">  File "&lt;stdin&gt;", line 1</span></span><br><span class="line"><span class="string">    s = '</span><span class="number">12</span><span class="string">'3'</span></span><br><span class="line">            ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
<p>但是，只是使用语句中不包含的那种引号来指示字符串有时候是行不通的，因为有时候一个字符串可能同时包含单引号和双引号，比如字符串<code>1&quot;2&#39;3</code>，所以这时候我们需要使用反斜线<code>\</code>来对内容进行转义，因此对于字符串<code>1&quot;2&#39;3</code>，我们可以采用如下表示:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'1"2\'3'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'1"2\'3'</span></span><br></pre></td></tr></table></figure>
<p>注意我们并没有对字符串内容中的双引号<code>&quot;</code>进行转义，原因同上，字符串使用单引号指示的，因此双引号只会被认为是一个普通的字符。对于字符串内部的单引号<code>&#39;</code>，为了让解释器得知它是一个普通字符，我们在其前面增加了一个反斜线<code>\</code>，<code>\&#39;</code>组合起来的意思是对反斜线后面的字符<code>&#39;</code>进行转义，可以这样理解，通过添加一个反斜线<code>\</code>，对于<code>\&#39;</code>，你告诉了解释器:<code>不要按照普通的方式去解释这个字符&#39;</code>，这样解释器就能正确地完成对该字符串的解释。</p>
<p>有编程基础的读者应该会知道<strong><em>转义</em></strong>这一概念广泛存在于很多编程语言中，对<code>\n</code>、<code>\r</code>等字符应该有一定了解，类比前面的解释，<code>\n</code>表示:<code>不要按照普通的方式去解释这个字符n</code>。</p>
<p>进一步理解，假设我们从键盘输入了字符串:<code>abc\nde</code>，一共输入了7个字符，这7个字符经过Python解释器解释，两个字符<code>\</code>和<code>n</code>将会被转义成一个字符<code>\n</code>，请特别注意这一点，虽然从表面上看是两个字符，但其实<code>\n</code>是一个特殊的字符，这一点我们可以从以下代码看出:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'abc\nde'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(s)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">0</span>]</span><br><span class="line"><span class="string">'a'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</span><br><span class="line"><span class="string">'b'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">2</span>]</span><br><span class="line"><span class="string">'c'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">3</span>]</span><br><span class="line"><span class="string">'\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">4</span>]</span><br><span class="line"><span class="string">'d'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">5</span>]</span><br><span class="line"><span class="string">'e'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">6</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">IndexError: string index out of range</span><br></pre></td></tr></table></figure>
<p>有了这些基础，下面我们进入到正则的部分。</p>
<h1 id="正则表达式中的反斜线"><a href="#正则表达式中的反斜线" class="headerlink" title="正则表达式中的反斜线\"></a>正则表达式中的反斜线<code>\</code></h1><p>因为有了Python解释器首先对字符串的转义，所以正则表达式模块<code>re</code>看到的和你输入的可能有所不同，比如，<code>\n</code>在字符串层被转义成一个换行字符，然后<code>re</code>看到的是字符<code>\n</code>而不是<code>\</code>和<code>n</code>两个字符，看以下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'abc\nde'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.search(<span class="string">'\n'</span>, s)</span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">3</span>, <span class="number">4</span>), match=<span class="string">'\n'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>以上代码首先定义了一个前文提到的字符串<code>s</code>，然后使用<code>re</code>模块的<code>search</code>方法搜索，然后要搜索的字符串是<code>\n</code>，注意我们输入的是字符<code>\</code>和字符<code>n</code>，然后经过Python解释器的解释实际在内存中的是一个<code>\n</code>字符，因此<code>re</code>模块看到的是只有一个字符的字符串<code>\n</code>，而不是两个字符，最后完成搜索。</p>
<p>如果我们想匹配字符串<code>\\\n</code>，应该怎么输入模式呢？，一种方法是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.compile(<span class="string">'\\\\\n'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.pattern</span><br><span class="line"><span class="string">'\\\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(s)</span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">2</span>), match=<span class="string">'\\\n'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>对于字符串<code>\\\n</code>，它的内容其实是一个普通的<code>\</code>字符和一个换行字符<code>\n</code>，对于我们输入的匹配模式<code>\\\\\n</code>，首先经过Python解释器的字符串解释，变成了两个普通的<code>\</code>字符和一个换行字符<code>\n</code>，然后这些内容通过<code>re</code>模块的<code>compile</code>方法，<code>compile</code>方法发现有两个连续的<code>\</code>符号，因此将在接下来的匹配中匹配一个普通的<code>\</code>字符(请注意理解这一点)，而<code>\n</code>字符将会匹配一个<code>\n</code>字符，因此该模式的匹配内容是字符串中的一个普通<code>\</code>字符和一个<code>\n</code>字符。当然，写这么多反斜线显得十分麻烦，所以Python也提供了一种方便的方式，即<strong><em>原始字符串</em></strong>，其格式为在字符串前添加一个<code>r</code>字符:<code>r&#39;content&#39;</code>，通过这样的书写方式，Python解释器将使用不同的规则来解释转义(原始字符串不能以<code>\</code>符号结尾)。因此上述模式可以简化为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.compile(<span class="string">r'\\\n'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.pattern</span><br><span class="line"><span class="string">'\\\\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(s)</span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">2</span>), match=<span class="string">'\\\n'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>让我们再回到普通字符串，考虑以下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.compile(<span class="string">'\\\n'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.pattern</span><br><span class="line"><span class="string">'\\\n'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(s)</span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">1</span>, <span class="number">2</span>), match=<span class="string">'\n'</span>&gt;</span><br></pre></td></tr></table></figure>
<p>对于模式<code>\\\n</code>，经过Python解释器的解释将变成一个普通’`字符和一个换行字符<code>\n</code>，<code>re</code>模块的<code>compile</code>方法将会看到以上解释结果，然后该模式组合起来就是:<strong>匹配一个换行字符<code>\n</code>的转义字符</strong>，也就是对换行字符<code>\n</code>进行转义！结果是:</p>
<div class="tip">对一个转义字符进行转义将会得到其本身</div>

<p>相关连接:</p>
<ul>
<li><a href="https://docs.python.org/3.6/library/re.html" target="_blank" rel="noopener">Regular expression operations</a></li>
<li><a href="http://stackoverflow.com/questions/33582162/backslashes-in-python-regular-expressions" target="_blank" rel="noopener">Backslashes in Python Regular Expressions</a></li>
</ul>
</div></article></div><script src="/js/comments.js"></script></main><footer class="apollo"><div class="paginator"><a href="/2017/05/10/New-to-asyncio/" class="prev">上一篇</a><a href="/2017/03/30/CPP-Access-n-d-array-with-1-d-index-array/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2018 <a href="http://youchen.me">David</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div></body></html>